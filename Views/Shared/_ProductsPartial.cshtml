@using Rozetka.Data.Entity
@model IEnumerable<Product>

 <div class="row">
      @foreach (var product in Model)
      { 
        <div class="col-md-4">
            <div class="card mb-4 shadow-sm">
                <!-- Перевірка на наявність зображення -->
                @if (product.ProductImages != null && product.ProductImages.Any())
                {
                    var firstImage = product.ProductImages.FirstOrDefault()?.ImageData; 

                    if (firstImage != null)
                    {
                         <img src="data:image/jpeg;base64,@Convert.ToBase64String(firstImage)" class="card-img-top" alt="@product.Title" /> 
                        /* ///////////////////////////////////////////// */
                        
                        /* ///////////////////////////////////////////// */

                        @* <div class="col-sm-8">
                            @if (!Model.Any())
                            {
                                <div class="container d-flex align-items-center justify-content-center">
                                    <h4><em>В зв'язку з тим, що сайт знаходиться в розробці, товари даної категорії ще відсутні! Але, якщо ви маєте права адміністратора, ви можете це виправити!:)</em></h4>
                                </div>
                            }
                            else
                            {
                                <div class="row row-cols-3 row-cols-md-5 g-1">
                                    @foreach (var productt in Model.Where(p => p.QuantityInStock > 0))
                                    {
                                        <div class="col" style="min-width: 160px">
                                            <div class="card h-100">
                                                <div class="d-flex justify-content-center p-1">
                                                    <a href="/Products/GetProduct?id=@productt.Id">
                                                        @if (productt.ProductImages != null && productt.ProductImages.Any())
                                                        {
                                                            var firstImage1 = product.ProductImages.FirstOrDefault();
                                                            var lastImage = product.ProductImages.LastOrDefault();

                                                            <img src="data:image;base64,@Convert.ToBase64String(firstImage1.ImageData)"
                                                                 alt="Product Image"
                                                                 style="max-height: 155px; width: auto; max-width: 100%;"
                                                                 onerror="this.onerror=null; this.src='/photoproducts/no-image.jpg';"
                                                                 onmouseover="this.src='data:image;base64,@Convert.ToBase64String(lastImage.ImageData)'"
                                                                 onmouseout="this.src='data:image;base64,@Convert.ToBase64String(firstImage1.ImageData)'" />
                                                        }
                                                        else
                                                        {
                                                            <img src="/photoproducts/no-image.jpg" alt="Photo" class="card-img-top" style="max-height: 155px;" />
                                                        }
                                                    </a>
                                                </div>
                                                <div class="row">
                                                    <div class="col">
                                                        <a type="button" class="link btn" onclick="addListCompare('@product.Id')">

                                                            <img src="~/icons/balance_icon.png" alt="Balance Icon" class="icon-img">
                                                        </a>

                                                    </div>
                                                </div>

                                                <div class="card-body">
                                                    <a class="a-card" href="/Products/GetProduct?id=@productt.Id">
                                                        <p class="card-text">@productt.ProductType.Title @productt.Brand.Title @productt.Title</p>
                                                    </a>
                                                    <h5 class="card-title">@productt.Price.ToString("0") ₴</h5>
                                                </div>

                                                <div class="product-item">
                                                    <!-- Кнопка для додавання товару в кошик (бічне вікно)-->
                                                    <button class="btn btn-primary"
                                                            onclick="addToCartAndOpenSidebar('@productt.Id', '@productt.Brand.Title', '@productt.Title', '@productt.ProductImages', '@productt.Price')">
                                                        <i class="bi bi-cart-plus"></i> Add to Cart
                                                    </button>


                                                    
                                                    <div class="mt-3">
                                                        <a href="@Url.Action("AddToCart", "Cart", new { id = productt.Id })" class="btn btn-primary btn-add-to-cart">
                                                            
                                                            <i class="bi bi-cart-plus"></i>
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    }
                                    @foreach ( var productt in Model.Where(p => p.QuantityInStock <= 0))
                                    {
                                        <div class="col">
                                            <div class="card h-100" style="opacity: 0.8;">

                                                <div class="d-flex justify-content-center p-1">
                                                    <a href="/Products/GetProduct?id=@productt.Id">
                                                        @if (productt.ProductImages != null && productt.ProductImages.Any())
                                                        {
                                                            var firstImage2 = productt.ProductImages.FirstOrDefault();

                                                            <img src="data:image;base64,@Convert.ToBase64String(firstImage2.ImageData)"
                                                                 alt="Product Image"
                                                                 style="max-height: 155px; width: auto; max-width: 100%;"
                                                                 onerror="this.onerror=null; this.src='/photoproducts/no-image.jpg';" />
                                                        }
                                                        else
                                                        {
                                                            <img src="/photoproducts/no-image.jpg" alt="Photo" class="card-img-top" style="max-height: 155px;" />
                                                        }
                                                    </a>
                                                </div>

                                                <div class="card-body">
                                                    <a class="a-card" href="/Products/GetProduct?id=@productt.Id">
                                                        <p class="card-text">@productt.ProductType.Title @productt.BrandId @productt.Title</p>
                                                    </a>
                                                    <h5 class="card-title">Немає в наявності</h5>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            }
                        </div> *@
                    }
                    else
                    {
                        <img src="/images/no-image-available.png" class="card-img-top" alt="No image available" />
                    }
                    /* ///////////////////////////////////////////////// */
                }
                else
                {
                    <img src="/images/no-image-available.png" class="card-img-top" alt="No image available" />
                } 

            <div class="card-body">
                <h5 class="card-title">@product.Title</h5>
                <p class="card-text">@product.Description</p>
                <p class="card-text">@product.Price.ToString("C")</p>
                @* <a href="@Url.Action("Details", "Product", new { id = product.Id })" class="btn btn-primary">View Details</a> *@
            </div>


            </div>
        </div> 
    } 
</div> 

